#!/usr/bin/env bash
# .git/hooks/prepare-commit-msg

MSG_FILE=$1
SOURCE=$2

# 1) ë¨¸ì§€/ìŠ¤ì¿¼ì‹œ ì»¤ë°‹ ê±´ë„ˆë›°ê¸°
if [[ "$SOURCE" == "merge" || "$SOURCE" == "squash" ]]; then
  exit 0
fi

# 2) ì²« ì¤„ ì½ê¸°
FIRST_LINE=$(head -n1 "$MSG_FILE")

# 3) í‚¤ì›Œë“œâ†’ì´ëª¨ì§€ ë§¤í•‘ (ë³¸ë¬¸ì€ ê·¸ëŒ€ë¡œ ìœ ì§€)
emoji=""
case "$FIRST_LINE" in
  init:*)     emoji="ðŸŽ‰"  ;;
  feat:*)     emoji="âœ¨"  ;;
  refactor:*) emoji="â™»ï¸" ;;
  fix:*)      emoji="ðŸ”§"  ;;
  style:*)    emoji="ðŸ’„"  ;;
  docs:*)     emoji="ðŸ“"  ;;
  build:*)    emoji="ðŸ—ï¸" ;;
  test:*)     emoji="ðŸ’¯"  ;;
  devops:*)   emoji="ðŸ³"  ;;
  *) 
    echo "âœ– ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ ì˜¤ë¥˜: init:, feat:, refactor:, fix:, style:, docs:, build:, test:, devops: ì¤‘ í•˜ë‚˜ë¡œ ì‹œìž‘í•´ì•¼ í•©ë‹ˆë‹¤." >&2
    exit 1
    ;;
esac

# ë³¸ë¬¸ì€ ì›ëž˜ ë©”ì‹œì§€ ê·¸ëŒ€ë¡œ
new="$FIRST_LINE"

# 4) ì•žë’¤ ê³µë°± ì œê±°
trimmed="$(echo "$new" | sed -E 's/^[[:space:]]+//;s/[[:space:]]+$//')"

# 5) ì²« ì¤„ êµì²´ (macOS/Linux ìžë™ ë¶„ê¸°)
if sed --version >/dev/null 2>&1; then
  # GNU sed (Linux, Git Bash)
  sed -i "1s~.*~$emoji $trimmed~" "$MSG_FILE"
else
  # BSD sed (macOS)
  sed -i '' "1s~.*~$emoji $trimmed~" "$MSG_FILE"
fi